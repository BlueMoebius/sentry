{% extends "sentry/bases/settings.html" %}

{% load crispy_forms_tags %}
{% load i18n %}
{% load sentry_helpers %}
{% load sentry_plugins %}

{% block bodyclass %} with-left-sidebar{% endblock %}

{% block controller %}ManageProjectCtrl{% endblock %}

{% block main %}

    {% block inner %}
        <h3>{% trans "Project Settings" %}</h3>
        <form class="form-stacked" action="." method="post">
            {% csrf_token %}

            {{ form|as_crispy_errors }}

            <div class="box">
              <div class="box-header">
                <h3>{% trans "Project Details" %}</h3>
              </div>
              <div class="box-content with-padding">
                {% for field in form %}
                    {% if field.name != 'origins' and field.name != 'public' and field.name != 'resolve_age' %}
                        {{ field|as_crispy_field }}
                    {% endif %}
                {% endfor %}
              </div>
            </div>

            <div class="box">
                <div class="box-header">
                  <h3>{% trans "Event Settings" %}</h3>
                </div>
                <div class="box-content with-padding">
                  {{ form.resolve_age|as_crispy_field }}
                  {% if form.public %}
                      {{ form.public|as_crispy_field }}
                  {% endif %}
                </div>
            </div>

            <div class="box">
                <div class="box-header">
                  <h3>{% trans "Client Security" %}</h3>
                </div>
                <div class="box-content with-padding">
                  {% with form.origins as field %}
                      <p>{% blocktrans with 'https://github.com/getsentry/raven-js' as link %}Configure origin URLs which Sentry should accept events from. This is used for communication with clients like <a href="{{ link }}">raven-js</a>.{% endblocktrans %}
                      <br>
                      {% blocktrans %}This will restrict requests based on the <code>Origin</code> and <code>Referer</code> headers.{% endblocktrans %}</p>
                      {{ field|as_crispy_field }}
                  {% endwith %}
                </div>
            </div>

            <div class="box">
              <div class="box-header">
                <h3>{% trans "Remove Project" %}</h3>
              </div>
              <div class="box-content with-padding">
                {% if not project.is_internal_project %}
                    <p class="clearfix">
                      <a href="{% url 'sentry-remove-project' project.team.slug project.slug %}" class="btn btn-danger pull-right">{% trans "Remove Project" %}</a>
                      Remove the <strong>{{ project.slug }}</strong> project from <strong>{{ project.team.slug }}</strong>. </br>
                      Careful, this action cannot be undone.
                    </p>
                {% else %}
                    <p>{% trans "This project cannot be removed. It is used internally by the Sentry server." %}</p>
                {% endif %}
              </div>
            </div>

            <div class="form-actions" style="border-top: 0; padding-top: 0;">
                <button type="submit" class="btn btn-primary btn-lg">{% trans "Save Changes" %}</button>
            </div>
        </form>
    {% endblock %}
{% endblock %}

{% block sidebar %}
    <ul class="nav nav-stacked">
        <li{% if page == 'details' %} class="active"{% endif %}>
            <a href="{% url 'sentry-manage-project' project.team.slug project.slug %}">{% trans "Project Settings" %}</a>
        </li>
        <li{% if page == 'notifications' %} class="active"{% endif %}>
            <a href="{% url 'sentry-project-notifications' project.team.slug project.slug %}">{% trans "Notifications" %}</a>
        </li>
        <li{% if page == 'quotas' %} class="active"{% endif %}>
            <a href="{% url 'sentry-manage-project-quotas' project.team.slug project.slug %}">{% trans "Rate Limits" %}</a>
        </li>
        <li{% if page == 'rules' %} class="active"{% endif %}>
            <a href="{% url 'sentry-project-rules' project.team.slug project.slug %}">{% trans "Rules" %}</a>
        </li>
        <li{% if page == 'tags' %} class="active"{% endif %}>
            <a href="{% url 'sentry-manage-project-tags' project.team.slug project.slug %}">{% trans "Tags" %}</a>
        </li>
        <li{% if page == 'keys' %} class="active"{% endif %}>
            <a href="{% url 'sentry-manage-project-keys' project.team.slug project.slug %}">{% trans "API Keys" %}</a>
        </li>
    </ul>
    {% with project|get_plugins as plugins %}
        <h6>{% trans "Integrations" %}</h6>
        <ul class="nav nav-stacked">
            <li class="{% if page == 'plugins' %} active{% endif %}">
                <a href="{% url 'sentry-manage-project-plugins' project.team.slug project.slug %}">{% trans "Manage Integrations" %} ({{ PLUGINS|length }})</a>
            </li>
            {% for p in plugins %}
                <li{% if page == 'plugin' and plugin.slug == p.slug %} class="active"{% endif %}>
                    <a href="{% url 'sentry-configure-project-plugin' project.team.slug project.slug p.slug %}">{{ p.get_title }}</a>
                </li>
            {% endfor %}
        </ul>
    {% endwith %}
{% endblock %}
